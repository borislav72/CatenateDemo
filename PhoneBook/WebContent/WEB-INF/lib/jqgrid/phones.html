<!DOCTYPE html>
<html lang="en">
<head>
    <script src="js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="js/jquery.jqGrid.js" type="text/javascript"></script>
    <script src="js/grid.locale-en.js" type="text/javascript"></script>
    <link href="css/jquery-ui-1.9.2.custom.css" rel="stylesheet" type="text/css" />
    <link href="css/ui.jqgrid.css" rel="stylesheet" type="text/css" />
<meta charset="utf-8" />
<title>Phone Book</title>
</head>
<body>
    <table id="jqGrid"></table>
    <div id="jqGridPager"></div>
    <script type="text/javascript"> 
    $(document).ready(function(){
    	$("#jqGrid").jqGrid({
	    	url:'http://localhost:8080/PhoneBook/rs/phonebook',
	    	datatype: "json",
	    	colNames:['Id', 'Code', 'Phone', 'Name'],
	    	colModel:[
		    	{name:'id',index:'id', width:55},
		    	{name:'countryCode.code',index:'countryCode.code', width:200}, 
		    	{name:'phone',index:'phone', width:200}, 
		    	{name:'name',index:'name', width:200}
	    	],
	    	rowNum:10,
	    	loadonce: true,
	    	rowList:[10,20,30],
	    	pager: '#jqGridPager',
	    	sortname: 'id',
	    	viewrecords: true,
	    	sortorder: "desc",
	    	caption:"",
	    	editurl: 'http://localhost:8080/PhoneBook/rs/phonebook'
	    	});
		//$("#jqGrid").jqGrid('filterToolbar', { stringResult: true, searchOnEnter: true });

		$('#jqGrid').jqGrid('navGrid', '#jqGridPager',
		    {
				edit: true,
	   			add: true,
	   			del: true,
	   			search: true,
	   			searchtext: "Search",
	   			addtext: "Add",
	   			edittext: "Edit",
	   			deltext:"Delete"
		    },
        {   //EDIT
            //                       height: 300,
            //                       width: 400,
            //                       top: 50,
            //                       left: 100,
            //                       dataheight: 280,
            closeOnEscape: true,//Closes the popup on pressing escape key
            reloadAfterSubmit: true,
            drag: true,
            afterSubmit: function (response, postdata) {
                if (response.responseText == "") {

                    $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid');//Reloads the grid after edit
                    return [true, '']
                }
                else {
                    $(this).jqGrid('setGridParam', { datatype: 'json' }).trigger('reloadGrid'); //Reloads the grid after edit
                    return [false, response.responseText]//Captures and displays the response text on th Edit window
                }
            },
            editData:  function () {
                    var sel_id = $('#jqGrid').jqGrid('getGridParam', 'selrow');
                    var value = $('#jqGrid').jqGrid('getCell', sel_id, '_id');
                    return value;
                }
        },
        {url: 'http://localhost:8080/PhoneBook/rs/phonebook', closeAfterAdd: true }
		);
		
    });      
    </script>
</body>
</html>